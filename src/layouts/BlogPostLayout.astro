---
import type { MarkdownHeading } from 'astro';
import type { CollectionEntry } from 'astro:content';
import PageContent from '../components/PageContent/PageContent.astro';
import RightSidebar from '../components/RightSidebar/RightSidebar.astro';
import BlogInfo from '../components/RightSidebar/BlogInfo.astro';
import { GITHUB_EDIT_URL } from '../consts';

type Props = CollectionEntry<'blog'>['data'] & {
	headings: MarkdownHeading[];
};

const { headings, title, description, pubDate, author, tags, ...data } = Astro.props;
const currentPage = Astro.url.pathname;
const currentFile = `src/content/${currentPage.replace(/\/$/, '')}.md`;
const githubEditUrl = `${GITHUB_EDIT_URL}/${currentFile}`;

---
<style>
	.layout {
		display: grid;
		grid-auto-flow: column;
		grid-template-columns: minmax(var(--gutter), 1fr) minmax(0, var(--max-width)) minmax(
				var(--gutter),
				1fr
			);
		overflow-x: hidden;
	}

	.grid-sidebar {
		height: 100vh;
		position: sticky;
		top: 0;
		padding: 0;
	}

	#grid-main {
		padding: var(--doc-padding) var(--gutter);
		grid-column-start: 1;
		grid-column-end: 3;
		display: flex;
		flex-direction: column;
		height: 100%;
	}

	#grid-right {
		display: none;
	}

	@media (min-width: 50em) {
		.layout {
			overflow: initial;
			grid-template-columns: 19rem minmax(0, var(--max-width)) 19rem;
			gap: 1em;
		}
		#grid-main {
			grid-column-start: 2;
		}
	}

	@media (min-width: 72em) {
		.layout {
			grid-template-columns: 20rem minmax(0, var(--max-width)) 18rem;
			padding-left: 0;
			padding-right: 0;
			margin: 0 auto;
		}

		#grid-right {
			grid-column: 3;
			display: flex;
		}
		#grid-main {
			margin-left: 20rem:
		}
	}
</style>
<style is:global>
	.layout > * {
		width: 100%;
		height: 100%;
	}

	.mobile-sidebar-toggle {
		overflow: hidden;
	}

	.mobile-sidebar-toggle #grid-left {
		display: block;
		top: 2rem;
	}
</style>

<main class="layout">
	<div id="grid-main">
		<PageContent title={data.title} headings={headings} githubEditUrl={githubEditUrl}>
			<h1 class="title">{title}</h1>
			<hr>
			<slot />
		</PageContent>
	</div>
	<aside id="grid-right" class="grid-sidebar" title="Table of Contents">
		<RightSidebar headings={headings} githubEditUrl={githubEditUrl}>
			<BlogInfo blog={Astro.props}/>
		</RightSidebar>
	</aside>
</main>
